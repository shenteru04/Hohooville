<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notifications - Registrar</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .notification-item.unread { background:#f8f9fa; font-weight:700; }
        .notification-time { font-size: 0.8rem; color: #6c757d; }
        .notifications-list { max-height: 60vh; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="sidebar-container"></div>

    <div class="main-content">
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn btn-outline-primary me-2 d-lg-none">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="ms-auto d-flex align-items-center"></div>
            </div>
        </nav>

        <div class="container-fluid mt-4">
            <h3>Notifications</h3>
            <div class="card">
                <div class="card-body">
                    <div id="notificationsContainer" class="list-group notifications-list">
                        <div class="list-group-item text-center small text-muted">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
            <script src="../../../js/sidebar.js"></script>
            <script>
        const API_URL = window.location.origin + '/hohoo-ville/api/notifications.php?action=get&role=registrar';

        function loadAll() {
            fetch(API_URL)
                .then(r => r.json())
                .then(data => renderAll(data))
                .catch(() => {
                    document.getElementById('notificationsContainer').innerHTML = '<div class="list-group-item text-center small text-muted">Failed to load</div>';
                });
        }

        function renderAll(items) {
            const cont = document.getElementById('notificationsContainer');
            if (!items || items.length === 0) {
                cont.innerHTML = '<div class="list-group-item text-center small text-muted">No notifications</div>';
                return;
            }
            cont.innerHTML = '';
            items.forEach(it => {
                const a = document.createElement('a');
                a.href = it.link || '#';
                a.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-start notification-item ' + (it.is_read? '' : 'unread');
                a.innerHTML = `<div>${it.message}</div><div class="notification-time">${it.time}</div>`;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    // mark read
                    fetch(window.location.origin + '/hohoo-ville/api/notifications.php?action=markRead&id=' + encodeURIComponent(it.id)).catch(()=>{});
                    if (it.link) window.location.href = it.link;
                });
                cont.appendChild(a);
            });
        }

        document.addEventListener('DOMContentLoaded', loadAll);
    </script>
</body>
</html>
